FROM dunglas/frankenphp:1-php8.4-alpine

# Install essentials only
RUN install-php-extensions pdo_sqlite opcache

# Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

WORKDIR /app

# Copy composer files
COPY composer.json composer.lock symfony.lock* ./

# Install dependencies
RUN composer install --no-scripts --no-interaction

# Copy app
COPY . .

# Permissions
RUN mkdir -p var && chmod -R 777 var

# Caddyfile
COPY Caddyfile /etc/caddy/Caddyfile

EXPOSE 80

CMD ["frankenphp", "run", "--config", "/etc/caddy/Caddyfile"]
